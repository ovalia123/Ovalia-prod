{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- ================= NAVBAR ================= -->
<nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="{% url 'index' %}">
      <img class="logo" src="{% static 'images/big_logo_black.png' %}" alt="Ovalia Atelier">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarsFurni">
      <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
        <li><a class="nav-link" href="{% url 'index' %}">Accueil</a></li>
        <li><a class="nav-link" href="{% url 'boutique' %}">Boutique</a></li>
        <li><a class="nav-link" href="{% url 'shop' %}">Bracelet</a></li>
        <li><a class="nav-link" href="{% url 'event' %}">Evenement</a></li>
        <li><a class="nav-link" href="{% url 'faq' %}">FAQ</a></li>
        <li><a class="nav-link" href="{% url 'contact' %}">Contact</a></li>
        <li><a class="nav-link" href="{% url 'cart' %}">
          <img src="{% static 'images/cart.svg' %}">
        </a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- ================= STYLES ================= -->
<style>
.checkout-section {
  background: #f6efe6;
  padding: 60px 0;
}
.checkout-title {
  text-align: center;
  font-family: serif;
  font-weight: 400;
  margin-bottom: 50px;
}
.checkout-box,
.checkout-summary {
  background: #ffffff;
  border-radius: 14px;
  padding: 30px;
}
.checkout-box h4,
.checkout-summary h4 {
  font-family: serif;
  font-weight: 400;
  margin-bottom: 25px;
}
.form-control {
  border-radius: 8px;
  padding: 12px 14px;
  border: 1px solid #ddd;
  font-size: 0.95rem;
}
.form-control:focus {
  box-shadow: none;
  border-color: #000;
}
.summary-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
}
.summary-total {
  display: flex;
  justify-content: space-between;
  font-size: 1.1rem;
  font-weight: 600;
}
.checkout-note {
  color: #666;
  font-size: 0.85rem;
  margin-top: 20px;
}
.back-link {
  color: #000;
  text-decoration: underline;
  font-size: 0.85rem;
}
.btn-dark {
  border-radius: 30px;
  padding: 12px;
  font-size: 0.95rem;
}
</style>

<!-- ================= CHECKOUT ================= -->
<section class="checkout-section">
  <div class="container">

    <h2 class="checkout-title">Finaliser la commande</h2>

    <form method="post" action="{% url 'create-checkout-session' %}">
      {% csrf_token %}

      <div class="row g-5">

        <!-- ========== LEFT / CUSTOMER INFO ========== -->
        <div class="col-md-7">
          <div class="checkout-box">

            <h4>Informations client</h4>

            <div class="row">
              <div class="col-md-6 mb-3">
                <input name="first_name" class="form-control" placeholder="Prénom" required>
              </div>
              <div class="col-md-6 mb-3">
                <input name="last_name" class="form-control" placeholder="Nom" required>
              </div>
            </div>

            <div class="mb-3">
              <input name="email" type="email" class="form-control" placeholder="Adresse courriel" required>
            </div>

            <div class="mb-3">
              <input name="phone" class="form-control" placeholder="Téléphone" required>
            </div>

            <div class="mb-3">
              <input name="address" class="form-control" placeholder="Adresse" required>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <input name="city" class="form-control" placeholder="Ville" required>
              </div>
              <div class="col-md-3 mb-3">
                <input name="postal_code" class="form-control" placeholder="Code postal" required>
              </div>
              <div class="col-md-3 mb-3">
                <input name="country" class="form-control" value="Canada" required>
              </div>
            </div>

            <div class="checkout-note">
              Paiement sécurisé via Stripe.  
              Aucune information bancaire n’est stockée.
            </div>

          </div>
        </div>

        <!-- ========== RIGHT / ORDER SUMMARY ========== -->
        <div class="col-md-5">
          <div class="checkout-summary">

            <h4>Votre commande</h4>

            {% for item in cart_items %}
            <div class="summary-item">
              <div>
                <strong>{{ item.sale.name }}</strong><br>
                <small>Quantité : {{ item.quantity }}</small>
              </div>
              <div>{{ item.subtotal }} $</div>
            </div>
            {% endfor %}

            <hr>

            <div class="summary-total">
              <span>Total</span>
              <span>{{ total }} $</span>
            </div>

            <button type="submit" class="btn btn-dark w-100 mt-4">
              Procéder au paiement
            </button>

            <div class="text-center mt-3">
              <a href="{% url 'cart' %}" class="back-link">
                Retour au panier
              </a>
            </div>

          </div>
        </div>

      </div>
    </form>

  </div>
</section>

{% endblock %}
